#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run ESLint on staged files and exit with error code if there are problems
echo "🔍 Running ESLint on staged files..."

# Get all staged files that match the patterns ESLint would check
staged_files=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(js|ts)$' || true)

# If there are no relevant files, skip the check
if [ -z "$staged_files" ]; then
  echo "✅ No JS/TS files to lint"
  exit 0
fi

# Run lint on staged files
lint_exit_code=0
echo "$staged_files" | xargs npm run lint -- --quiet || lint_exit_code=$?

# If linting failed, prevent the commit
if [ $lint_exit_code -ne 0 ]; then
  echo "❌ ESLint found issues that must be fixed before committing"
  exit 1
fi

echo "✅ Linting passed"
